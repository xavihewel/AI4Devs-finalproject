57799c9f139c67f75a3f42cc774c9aa7
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const MatchFilterService_1 = require("./MatchFilterService");
const FilterStrategyFactory_1 = require("../factories/FilterStrategyFactory");
const SortStrategyFactory_1 = require("../factories/SortStrategyFactory");
const mockMatches = [
    {
        id: 'match-1',
        tripId: 'trip-1',
        driverId: 'driver-1',
        score: 0.9,
        status: 'PENDING',
        origin: '40.4168,-3.7038',
        destinationSedeId: 'SEDE-1',
        dateTime: '2024-01-15T08:30:00Z',
        seatsFree: 4,
        reasons: ['Same route'],
        direction: 'TO_SEDE',
        pairedTripId: null
    },
    {
        id: 'match-2',
        tripId: 'trip-2',
        driverId: 'driver-2',
        score: 0.6,
        status: 'PENDING',
        origin: '40.4200,-3.7000',
        destinationSedeId: 'SEDE-1',
        dateTime: '2024-01-15T09:00:00Z',
        seatsFree: 2,
        reasons: ['Similar time'],
        direction: 'TO_SEDE',
        pairedTripId: null
    },
    {
        id: 'match-3',
        tripId: 'trip-3',
        driverId: 'driver-3',
        score: 0.3,
        status: 'PENDING',
        origin: '40.4100,-3.7100',
        destinationSedeId: 'SEDE-1',
        dateTime: '2024-01-16T08:00:00Z',
        seatsFree: 1,
        reasons: ['Different route'],
        direction: 'TO_SEDE',
        pairedTripId: null
    }
];
describe('MatchFilterService', () => {
    let filterService;
    beforeEach(() => {
        filterService = new MatchFilterService_1.MatchFilterService(new FilterStrategyFactory_1.ConcreteFilterStrategyFactory(), new SortStrategyFactory_1.ConcreteSortStrategyFactory());
    });
    describe('processMatches', () => {
        it('applies score filter correctly', () => {
            const filters = {
                minScore: 70,
                minSeats: 1,
                dateFrom: '',
                dateTo: '',
                sortBy: 'score',
                sortOrder: 'desc'
            };
            const result = filterService.processMatches(mockMatches, filters);
            expect(result).toHaveLength(1);
            expect(result[0].score).toBeGreaterThanOrEqual(0.7);
        });
        it('applies seats filter correctly', () => {
            const filters = {
                minScore: 0,
                minSeats: 3,
                dateFrom: '',
                dateTo: '',
                sortBy: 'score',
                sortOrder: 'desc'
            };
            const result = filterService.processMatches(mockMatches, filters);
            expect(result).toHaveLength(1);
            expect(result[0].seatsFree).toBeGreaterThanOrEqual(3);
        });
        it('applies date range filter correctly', () => {
            const filters = {
                minScore: 0,
                minSeats: 1,
                dateFrom: '2024-01-15',
                dateTo: '2024-01-15',
                sortBy: 'score',
                sortOrder: 'desc'
            };
            const result = filterService.processMatches(mockMatches, filters);
            expect(result).toHaveLength(2);
            result.forEach(match => {
                const matchDate = new Date(match.dateTime);
                expect(matchDate.getDate()).toBe(15);
            });
        });
        it('sorts by score in descending order', () => {
            const filters = {
                minScore: 0,
                minSeats: 1,
                dateFrom: '',
                dateTo: '',
                sortBy: 'score',
                sortOrder: 'desc'
            };
            const result = filterService.processMatches(mockMatches, filters);
            expect(result[0].score).toBeGreaterThanOrEqual(result[1].score);
            expect(result[1].score).toBeGreaterThanOrEqual(result[2].score);
        });
        it('sorts by score in ascending order', () => {
            const filters = {
                minScore: 0,
                minSeats: 1,
                dateFrom: '',
                dateTo: '',
                sortBy: 'score',
                sortOrder: 'asc'
            };
            const result = filterService.processMatches(mockMatches, filters);
            expect(result[0].score).toBeLessThanOrEqual(result[1].score);
            expect(result[1].score).toBeLessThanOrEqual(result[2].score);
        });
        it('sorts by date in descending order', () => {
            const filters = {
                minScore: 0,
                minSeats: 1,
                dateFrom: '',
                dateTo: '',
                sortBy: 'date',
                sortOrder: 'desc'
            };
            const result = filterService.processMatches(mockMatches, filters);
            const date1 = new Date(result[0].dateTime);
            const date2 = new Date(result[1].dateTime);
            const date3 = new Date(result[2].dateTime);
            expect(date1.getTime()).toBeGreaterThanOrEqual(date2.getTime());
            expect(date2.getTime()).toBeGreaterThanOrEqual(date3.getTime());
        });
        it('sorts by seats in descending order', () => {
            const filters = {
                minScore: 0,
                minSeats: 1,
                dateFrom: '',
                dateTo: '',
                sortBy: 'seats',
                sortOrder: 'desc'
            };
            const result = filterService.processMatches(mockMatches, filters);
            expect(result[0].seatsFree).toBeGreaterThanOrEqual(result[1].seatsFree);
            expect(result[1].seatsFree).toBeGreaterThanOrEqual(result[2].seatsFree);
        });
        it('applies multiple filters correctly', () => {
            const filters = {
                minScore: 50,
                minSeats: 2,
                dateFrom: '2024-01-15',
                dateTo: '2024-01-15',
                sortBy: 'score',
                sortOrder: 'desc'
            };
            const result = filterService.processMatches(mockMatches, filters);
            expect(result).toHaveLength(1);
            expect(result[0].score).toBeGreaterThanOrEqual(0.5);
            expect(result[0].seatsFree).toBeGreaterThanOrEqual(2);
        });
        it('returns empty array when no matches meet criteria', () => {
            const filters = {
                minScore: 95,
                minSeats: 1,
                dateFrom: '',
                dateTo: '',
                sortBy: 'score',
                sortOrder: 'desc'
            };
            const result = filterService.processMatches(mockMatches, filters);
            expect(result).toHaveLength(0);
        });
    });
    describe('getActiveFilterNames', () => {
        it('returns empty array when no filters are active', () => {
            const filters = {
                minScore: 0,
                minSeats: 1,
                dateFrom: '',
                dateTo: ''
            };
            const result = filterService.getActiveFilterNames(filters);
            expect(result).toHaveLength(0);
        });
        it('returns score filter name when score filter is active', () => {
            const filters = {
                minScore: 70,
                minSeats: 1,
                dateFrom: '',
                dateTo: ''
            };
            const result = filterService.getActiveFilterNames(filters);
            expect(result).toContain('Score ≥ 70%');
        });
        it('returns seats filter name when seats filter is active', () => {
            const filters = {
                minScore: 0,
                minSeats: 3,
                dateFrom: '',
                dateTo: ''
            };
            const result = filterService.getActiveFilterNames(filters);
            expect(result).toContain('Seats ≥ 3');
        });
        it('returns date filter name when date filter is active', () => {
            const filters = {
                minScore: 0,
                minSeats: 1,
                dateFrom: '2024-01-15',
                dateTo: '2024-01-16'
            };
            const result = filterService.getActiveFilterNames(filters);
            expect(result).toHaveLength(1);
            expect(result[0]).toContain('From');
            expect(result[0]).toContain('To');
        });
        it('returns multiple filter names when multiple filters are active', () => {
            const filters = {
                minScore: 60,
                minSeats: 2,
                dateFrom: '2024-01-15',
                dateTo: ''
            };
            const result = filterService.getActiveFilterNames(filters);
            expect(result).toHaveLength(2);
            expect(result).toContain('Score ≥ 60%');
            expect(result).toContain('Seats ≥ 2');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2FkbWluL0RvY3VtZW50cy9BSTREZXZzLWZpbmFscHJvamVjdC9Gcm9udGVuZC9zcmMvY29tcG9uZW50cy9tYXRjaGVzL3NlcnZpY2VzL01hdGNoRmlsdGVyU2VydmljZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkRBQTBEO0FBQzFELDhFQUFtRjtBQUNuRiwwRUFBK0U7QUFHL0UsTUFBTSxXQUFXLEdBQWU7SUFDOUI7UUFDRSxFQUFFLEVBQUUsU0FBUztRQUNiLE1BQU0sRUFBRSxRQUFRO1FBQ2hCLFFBQVEsRUFBRSxVQUFVO1FBQ3BCLEtBQUssRUFBRSxHQUFHO1FBQ1YsTUFBTSxFQUFFLFNBQVM7UUFDakIsTUFBTSxFQUFFLGlCQUFpQjtRQUN6QixpQkFBaUIsRUFBRSxRQUFRO1FBQzNCLFFBQVEsRUFBRSxzQkFBc0I7UUFDaEMsU0FBUyxFQUFFLENBQUM7UUFDWixPQUFPLEVBQUUsQ0FBQyxZQUFZLENBQUM7UUFDdkIsU0FBUyxFQUFFLFNBQVM7UUFDcEIsWUFBWSxFQUFFLElBQUk7S0FDbkI7SUFDRDtRQUNFLEVBQUUsRUFBRSxTQUFTO1FBQ2IsTUFBTSxFQUFFLFFBQVE7UUFDaEIsUUFBUSxFQUFFLFVBQVU7UUFDcEIsS0FBSyxFQUFFLEdBQUc7UUFDVixNQUFNLEVBQUUsU0FBUztRQUNqQixNQUFNLEVBQUUsaUJBQWlCO1FBQ3pCLGlCQUFpQixFQUFFLFFBQVE7UUFDM0IsUUFBUSxFQUFFLHNCQUFzQjtRQUNoQyxTQUFTLEVBQUUsQ0FBQztRQUNaLE9BQU8sRUFBRSxDQUFDLGNBQWMsQ0FBQztRQUN6QixTQUFTLEVBQUUsU0FBUztRQUNwQixZQUFZLEVBQUUsSUFBSTtLQUNuQjtJQUNEO1FBQ0UsRUFBRSxFQUFFLFNBQVM7UUFDYixNQUFNLEVBQUUsUUFBUTtRQUNoQixRQUFRLEVBQUUsVUFBVTtRQUNwQixLQUFLLEVBQUUsR0FBRztRQUNWLE1BQU0sRUFBRSxTQUFTO1FBQ2pCLE1BQU0sRUFBRSxpQkFBaUI7UUFDekIsaUJBQWlCLEVBQUUsUUFBUTtR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QUFvQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRTNELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUN4QyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3hDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvYWRtaW4vRG9jdW1lbnRzL0FJNERldnMtZmluYWxwcm9qZWN0L0Zyb250ZW5kL3NyYy9jb21wb25lbnRzL21hdGNoZXMvc2VydmljZXMvTWF0Y2hGaWx0ZXJTZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWF0Y2hGaWx0ZXJTZXJ2aWNlIH0gZnJvbSAnLi9NYXRjaEZpbHRlclNlcnZpY2UnO1xuaW1wb3J0IHsgQ29uY3JldGVGaWx0ZXJTdHJhdGVneUZhY3RvcnkgfSBmcm9tICcuLi9mYWN0b3JpZXMvRmlsdGVyU3RyYXRlZ3lGYWN0b3J5JztcbmltcG9ydCB7IENvbmNyZXRlU29ydFN0cmF0ZWd5RmFjdG9yeSB9IGZyb20gJy4uL2ZhY3Rvcmllcy9Tb3J0U3RyYXRlZ3lGYWN0b3J5JztcbmltcG9ydCB0eXBlIHsgTWF0Y2hEdG8gfSBmcm9tICcuLi8uLi8uLi90eXBlcy9hcGknO1xuXG5jb25zdCBtb2NrTWF0Y2hlczogTWF0Y2hEdG9bXSA9IFtcbiAge1xuICAgIGlkOiAnbWF0Y2gtMScsXG4gICAgdHJpcElkOiAndHJpcC0xJyxcbiAgICBkcml2ZXJJZDogJ2RyaXZlci0xJyxcbiAgICBzY29yZTogMC45LFxuICAgIHN0YXR1czogJ1BFTkRJTkcnLFxuICAgIG9yaWdpbjogJzQwLjQxNjgsLTMuNzAzOCcsXG4gICAgZGVzdGluYXRpb25TZWRlSWQ6ICdTRURFLTEnLFxuICAgIGRhdGVUaW1lOiAnMjAyNC0wMS0xNVQwODozMDowMFonLFxuICAgIHNlYXRzRnJlZTogNCxcbiAgICByZWFzb25zOiBbJ1NhbWUgcm91dGUnXSxcbiAgICBkaXJlY3Rpb246ICdUT19TRURFJyxcbiAgICBwYWlyZWRUcmlwSWQ6IG51bGxcbiAgfSxcbiAge1xuICAgIGlkOiAnbWF0Y2gtMicsXG4gICAgdHJpcElkOiAndHJpcC0yJyxcbiAgICBkcml2ZXJJZDogJ2RyaXZlci0yJyxcbiAgICBzY29yZTogMC42LFxuICAgIHN0YXR1czogJ1BFTkRJTkcnLFxuICAgIG9yaWdpbjogJzQwLjQyMDAsLTMuNzAwMCcsXG4gICAgZGVzdGluYXRpb25TZWRlSWQ6ICdTRURFLTEnLFxuICAgIGRhdGVUaW1lOiAnMjAyNC0wMS0xNVQwOTowMDowMFonLFxuICAgIHNlYXRzRnJlZTogMixcbiAgICByZWFzb25zOiBbJ1NpbWlsYXIgdGltZSddLFxuICAgIGRpcmVjdGlvbjogJ1RPX1NFREUnLFxuICAgIHBhaXJlZFRyaXBJZDogbnVsbFxuICB9LFxuICB7XG4gICAgaWQ6ICdtYXRjaC0zJyxcbiAgICB0cmlwSWQ6ICd0cmlwLTMnLFxuICAgIGRyaXZlcklkOiAnZHJpdmVyLTMnLFxuICAgIHNjb3JlOiAwLjMsXG4gICAgc3RhdHVzOiAnUEVORElORycsXG4gICAgb3JpZ2luOiAnNDAuNDEwMCwtMy43MTAwJyxcbiAgICBkZXN0aW5hdGlvblNlZGVJZDogJ1NFREUtMScsXG4gICAgZGF0ZVRpbWU6ICcyMDI0LTAxLTE2VDA4OjAwOjAwWicsXG4gICAgc2VhdHNGcmVlOiAxLFxuICAgIHJlYXNvbnM6IFsnRGlmZmVyZW50IHJvdXRlJ10sXG4gICAgZGlyZWN0aW9uOiAnVE9fU0VERScsXG4gICAgcGFpcmVkVHJpcElkOiBudWxsXG4gIH1cbl07XG5cbmRlc2NyaWJlKCdNYXRjaEZpbHRlclNlcnZpY2UnLCAoKSA9PiB7XG4gIGxldCBmaWx0ZXJTZXJ2aWNlOiBNYXRjaEZpbHRlclNlcnZpY2U7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgZmlsdGVyU2VydmljZSA9IG5ldyBNYXRjaEZpbHRlclNlcnZpY2UoXG4gICAgICBuZXcgQ29uY3JldGVGaWx0ZXJTdHJhdGVneUZhY3RvcnkoKSxcbiAgICAgIG5ldyBDb25jcmV0ZVNvcnRTdHJhdGVneUZhY3RvcnkoKVxuICAgICk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdwcm9jZXNzTWF0Y2hlcycsICgpID0+IHtcbiAgICBpdCgnYXBwbGllcyBzY29yZSBmaWx0ZXIgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsdGVycyA9IHtcbiAgICAgICAgbWluU2NvcmU6IDcwLFxuICAgICAgICBtaW5TZWF0czogMSxcbiAgICAgICAgZGF0ZUZyb206ICcnLFxuICAgICAgICBkYXRlVG86ICcnLFxuICAgICAgICBzb3J0Qnk6ICdzY29yZScgYXMgY29uc3QsXG4gICAgICAgIHNvcnRPcmRlcjogJ2Rlc2MnIGFzIGNvbnN0XG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaWx0ZXJTZXJ2aWNlLnByb2Nlc3NNYXRjaGVzKG1vY2tNYXRjaGVzLCBmaWx0ZXJzKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdFswXS5zY29yZSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwLjcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2FwcGxpZXMgc2VhdHMgZmlsdGVyIGNvcnJlY3RseScsICgpID0+IHtcbiAgICAgIGNvbnN0IGZpbHRlcnMgPSB7XG4gICAgICAgIG1pblNjb3JlOiAwLFxuICAgICAgICBtaW5TZWF0czogMyxcbiAgICAgICAgZGF0ZUZyb206ICcnLFxuICAgICAgICBkYXRlVG86ICcnLFxuICAgICAgICBzb3J0Qnk6ICdzY29yZScgYXMgY29uc3QsXG4gICAgICAgIHNvcnRPcmRlcjogJ2Rlc2MnIGFzIGNvbnN0XG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaWx0ZXJTZXJ2aWNlLnByb2Nlc3NNYXRjaGVzKG1vY2tNYXRjaGVzLCBmaWx0ZXJzKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdFswXS5zZWF0c0ZyZWUpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMyk7XG4gICAgfSk7XG5cbiAgICBpdCgnYXBwbGllcyBkYXRlIHJhbmdlIGZpbHRlciBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBmaWx0ZXJzID0ge1xuICAgICAgICBtaW5TY29yZTogMCxcbiAgICAgICAgbWluU2VhdHM6IDEsXG4gICAgICAgIGRhdGVGcm9tOiAnMjAyNC0wMS0xNScsXG4gICAgICAgIGRhdGVUbzogJzIwMjQtMDEtMTUnLFxuICAgICAgICBzb3J0Qnk6ICdzY29yZScgYXMgY29uc3QsXG4gICAgICAgIHNvcnRPcmRlcjogJ2Rlc2MnIGFzIGNvbnN0XG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaWx0ZXJTZXJ2aWNlLnByb2Nlc3NNYXRjaGVzKG1vY2tNYXRjaGVzLCBmaWx0ZXJzKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgcmVzdWx0LmZvckVhY2gobWF0Y2ggPT4ge1xuICAgICAgICBjb25zdCBtYXRjaERhdGUgPSBuZXcgRGF0ZShtYXRjaC5kYXRlVGltZSk7XG4gICAgICAgIGV4cGVjdChtYXRjaERhdGUuZ2V0RGF0ZSgpKS50b0JlKDE1KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3NvcnRzIGJ5IHNjb3JlIGluIGRlc2NlbmRpbmcgb3JkZXInLCAoKSA9PiB7XG4gICAgICBjb25zdCBmaWx0ZXJzID0ge1xuICAgICAgICBtaW5TY29yZTogMCxcbiAgICAgICAgbWluU2VhdHM6IDEsXG4gICAgICAgIGRhdGVGcm9tOiAnJyxcbiAgICAgICAgZGF0ZVRvOiAnJyxcbiAgICAgICAgc29ydEJ5OiAnc2NvcmUnIGFzIGNvbnN0LFxuICAgICAgICBzb3J0T3JkZXI6ICdkZXNjJyBhcyBjb25zdFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZmlsdGVyU2VydmljZS5wcm9jZXNzTWF0Y2hlcyhtb2NrTWF0Y2hlcywgZmlsdGVycyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHRbMF0uc2NvcmUpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwocmVzdWx0WzFdLnNjb3JlKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMV0uc2NvcmUpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwocmVzdWx0WzJdLnNjb3JlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzb3J0cyBieSBzY29yZSBpbiBhc2NlbmRpbmcgb3JkZXInLCAoKSA9PiB7XG4gICAgICBjb25zdCBmaWx0ZXJzID0ge1xuICAgICAgICBtaW5TY29yZTogMCxcbiAgICAgICAgbWluU2VhdHM6IDEsXG4gICAgICAgIGRhdGVGcm9tOiAnJyxcbiAgICAgICAgZGF0ZVRvOiAnJyxcbiAgICAgICAgc29ydEJ5OiAnc2NvcmUnIGFzIGNvbnN0LFxuICAgICAgICBzb3J0T3JkZXI6ICdhc2MnIGFzIGNvbnN0XG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaWx0ZXJTZXJ2aWNlLnByb2Nlc3NNYXRjaGVzKG1vY2tNYXRjaGVzLCBmaWx0ZXJzKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdFswXS5zY29yZSkudG9CZUxlc3NUaGFuT3JFcXVhbChyZXN1bHRbMV0uc2NvcmUpO1xuICAgICAgZXhwZWN0KHJlc3VsdFsxXS5zY29yZSkudG9CZUxlc3NUaGFuT3JFcXVhbChyZXN1bHRbMl0uc2NvcmUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3NvcnRzIGJ5IGRhdGUgaW4gZGVzY2VuZGluZyBvcmRlcicsICgpID0+IHtcbiAgICAgIGNvbnN0IGZpbHRlcnMgPSB7XG4gICAgICAgIG1pblNjb3JlOiAwLFxuICAgICAgICBtaW5TZWF0czogMSxcbiAgICAgICAgZGF0ZUZyb206ICcnLFxuICAgICAgICBkYXRlVG86ICcnLFxuICAgICAgICBzb3J0Qnk6ICdkYXRlJyBhcyBjb25zdCxcbiAgICAgICAgc29ydE9yZGVyOiAnZGVzYycgYXMgY29uc3RcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpbHRlclNlcnZpY2UucHJvY2Vzc01hdGNoZXMobW9ja01hdGNoZXMsIGZpbHRlcnMpO1xuXG4gICAgICBjb25zdCBkYXRlMSA9IG5ldyBEYXRlKHJlc3VsdFswXS5kYXRlVGltZSk7XG4gICAgICBjb25zdCBkYXRlMiA9IG5ldyBEYXRlKHJlc3VsdFsxXS5kYXRlVGltZSk7XG4gICAgICBjb25zdCBkYXRlMyA9IG5ldyBEYXRlKHJlc3VsdFsyXS5kYXRlVGltZSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChkYXRlMS5nZXRUaW1lKCkpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoZGF0ZTIuZ2V0VGltZSgpKTtcbiAgICAgIGV4cGVjdChkYXRlMi5nZXRUaW1lKCkpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoZGF0ZTMuZ2V0VGltZSgpKTtcbiAgICB9KTtcblxuICAgIGl0KCdzb3J0cyBieSBzZWF0cyBpbiBkZXNjZW5kaW5nIG9yZGVyJywgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsdGVycyA9IHtcbiAgICAgICAgbWluU2NvcmU6IDAsXG4gICAgICAgIG1pblNlYXRzOiAxLFxuICAgICAgICBkYXRlRnJvbTogJycsXG4gICAgICAgIGRhdGVUbzogJycsXG4gICAgICAgIHNvcnRCeTogJ3NlYXRzJyBhcyBjb25zdCxcbiAgICAgICAgc29ydE9yZGVyOiAnZGVzYycgYXMgY29uc3RcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpbHRlclNlcnZpY2UucHJvY2Vzc01hdGNoZXMobW9ja01hdGNoZXMsIGZpbHRlcnMpO1xuXG4gICAgICBleHBlY3QocmVzdWx0WzBdLnNlYXRzRnJlZSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbChyZXN1bHRbMV0uc2VhdHNGcmVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMV0uc2VhdHNGcmVlKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKHJlc3VsdFsyXS5zZWF0c0ZyZWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2FwcGxpZXMgbXVsdGlwbGUgZmlsdGVycyBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBmaWx0ZXJzID0ge1xuICAgICAgICBtaW5TY29yZTogNTAsXG4gICAgICAgIG1pblNlYXRzOiAyLFxuICAgICAgICBkYXRlRnJvbTogJzIwMjQtMDEtMTUnLFxuICAgICAgICBkYXRlVG86ICcyMDI0LTAxLTE1JyxcbiAgICAgICAgc29ydEJ5OiAnc2NvcmUnIGFzIGNvbnN0LFxuICAgICAgICBzb3J0T3JkZXI6ICdkZXNjJyBhcyBjb25zdFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZmlsdGVyU2VydmljZS5wcm9jZXNzTWF0Y2hlcyhtb2NrTWF0Y2hlcywgZmlsdGVycyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0uc2NvcmUpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMC41KTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0uc2VhdHNGcmVlKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgZW1wdHkgYXJyYXkgd2hlbiBubyBtYXRjaGVzIG1lZXQgY3JpdGVyaWEnLCAoKSA9PiB7XG4gICAgICBjb25zdCBmaWx0ZXJzID0ge1xuICAgICAgICBtaW5TY29yZTogOTUsXG4gICAgICAgIG1pblNlYXRzOiAxLFxuICAgICAgICBkYXRlRnJvbTogJycsXG4gICAgICAgIGRhdGVUbzogJycsXG4gICAgICAgIHNvcnRCeTogJ3Njb3JlJyBhcyBjb25zdCxcbiAgICAgICAgc29ydE9yZGVyOiAnZGVzYycgYXMgY29uc3RcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpbHRlclNlcnZpY2UucHJvY2Vzc01hdGNoZXMobW9ja01hdGNoZXMsIGZpbHRlcnMpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRBY3RpdmVGaWx0ZXJOYW1lcycsICgpID0+IHtcbiAgICBpdCgncmV0dXJucyBlbXB0eSBhcnJheSB3aGVuIG5vIGZpbHRlcnMgYXJlIGFjdGl2ZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGZpbHRlcnMgPSB7XG4gICAgICAgIG1pblNjb3JlOiAwLFxuICAgICAgICBtaW5TZWF0czogMSxcbiAgICAgICAgZGF0ZUZyb206ICcnLFxuICAgICAgICBkYXRlVG86ICcnXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaWx0ZXJTZXJ2aWNlLmdldEFjdGl2ZUZpbHRlck5hbWVzKGZpbHRlcnMpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyBzY29yZSBmaWx0ZXIgbmFtZSB3aGVuIHNjb3JlIGZpbHRlciBpcyBhY3RpdmUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBmaWx0ZXJzID0ge1xuICAgICAgICBtaW5TY29yZTogNzAsXG4gICAgICAgIG1pblNlYXRzOiAxLFxuICAgICAgICBkYXRlRnJvbTogJycsXG4gICAgICAgIGRhdGVUbzogJydcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpbHRlclNlcnZpY2UuZ2V0QWN0aXZlRmlsdGVyTmFtZXMoZmlsdGVycyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQ29udGFpbignU2NvcmUg4omlIDcwJScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgc2VhdHMgZmlsdGVyIG5hbWUgd2hlbiBzZWF0cyBmaWx0ZXIgaXMgYWN0aXZlJywgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsdGVycyA9IHtcbiAgICAgICAgbWluU2NvcmU6IDAsXG4gICAgICAgIG1pblNlYXRzOiAzLFxuICAgICAgICBkYXRlRnJvbTogJycsXG4gICAgICAgIGRhdGVUbzogJydcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpbHRlclNlcnZpY2UuZ2V0QWN0aXZlRmlsdGVyTmFtZXMoZmlsdGVycyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQ29udGFpbignU2VhdHMg4omlIDMnKTtcbiAgICB9KTtcblxuICAgIGl0KCdyZXR1cm5zIGRhdGUgZmlsdGVyIG5hbWUgd2hlbiBkYXRlIGZpbHRlciBpcyBhY3RpdmUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBmaWx0ZXJzID0ge1xuICAgICAgICBtaW5TY29yZTogMCxcbiAgICAgICAgbWluU2VhdHM6IDEsXG4gICAgICAgIGRhdGVGcm9tOiAnMjAyNC0wMS0xNScsXG4gICAgICAgIGRhdGVUbzogJzIwMjQtMDEtMTYnXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaWx0ZXJTZXJ2aWNlLmdldEFjdGl2ZUZpbHRlck5hbWVzKGZpbHRlcnMpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocmVzdWx0WzBdKS50b0NvbnRhaW4oJ0Zyb20nKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0pLnRvQ29udGFpbignVG8nKTtcbiAgICB9KTtcblxuICAgIGl0KCdyZXR1cm5zIG11bHRpcGxlIGZpbHRlciBuYW1lcyB3aGVuIG11bHRpcGxlIGZpbHRlcnMgYXJlIGFjdGl2ZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGZpbHRlcnMgPSB7XG4gICAgICAgIG1pblNjb3JlOiA2MCxcbiAgICAgICAgbWluU2VhdHM6IDIsXG4gICAgICAgIGRhdGVGcm9tOiAnMjAyNC0wMS0xNScsXG4gICAgICAgIGRhdGVUbzogJydcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpbHRlclNlcnZpY2UuZ2V0QWN0aXZlRmlsdGVyTmFtZXMoZmlsdGVycyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQ29udGFpbignU2NvcmUg4omlIDYwJScpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9Db250YWluKCdTZWF0cyDiiaUgMicpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9