2f1a6143cbbadeb1034a990659eb1603
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
// Mock axios.create used inside the service
globals_1.jest.mock('axios', () => {
    const instance = {
        get: globals_1.jest.fn(),
        interceptors: {
            request: {
                use: globals_1.jest.fn(),
            },
        },
    };
    return {
        __esModule: true,
        default: {
            create: () => instance,
            _instance: instance,
        },
        create: () => instance,
        _instance: instance,
    };
});
const matches_1 = require("./matches");
const axios_1 = __importDefault(require("axios"));
(0, globals_1.describe)('MatchesService', () => {
    (0, globals_1.beforeEach)(() => {
        globals_1.jest.clearAllMocks();
    });
    (0, globals_1.describe)('findMatches', () => {
        (0, globals_1.it)('should find matches with all parameters', async () => {
            const mockMatches = [
                {
                    id: '1',
                    tripId: 'trip1',
                    driverId: 'driver1',
                    origin: '40.4168,-3.7038',
                    destinationSedeId: 'SEDE-1',
                    dateTime: '2024-01-01T08:00:00Z',
                    seatsFree: 2,
                    score: 0.85,
                    reasons: ['Ubicación cercana', 'Horario compatible'],
                },
            ];
            axios_1.default._instance.get.mockResolvedValue({ data: mockMatches });
            const params = {
                destinationSedeId: 'SEDE-1',
                time: '08:30',
                origin: '40.4168,-3.7038',
            };
            const result = await matches_1.MatchesService.findMatches(params);
            (0, globals_1.expect)(axios_1.default._instance.get).toHaveBeenCalledWith('/matches?destinationSedeId=SEDE-1&time=08%3A30&origin=40.4168%2C-3.7038');
            (0, globals_1.expect)(result).toEqual(mockMatches);
        });
        (0, globals_1.it)('should find matches with only destination', async () => {
            const mockMatches = [];
            axios_1.default._instance.get.mockResolvedValue({ data: mockMatches });
            const params = {
                destinationSedeId: 'SEDE-1',
            };
            const result = await matches_1.MatchesService.findMatches(params);
            (0, globals_1.expect)(axios_1.default._instance.get).toHaveBeenCalledWith('/matches?destinationSedeId=SEDE-1');
            (0, globals_1.expect)(result).toEqual(mockMatches);
        });
        (0, globals_1.it)('should find matches with destination and time', async () => {
            const mockMatches = [];
            axios_1.default._instance.get.mockResolvedValue({ data: mockMatches });
            const params = {
                destinationSedeId: 'SEDE-1',
                time: '09:00',
            };
            const result = await matches_1.MatchesService.findMatches(params);
            (0, globals_1.expect)(axios_1.default._instance.get).toHaveBeenCalledWith('/matches?destinationSedeId=SEDE-1&time=09%3A00');
            (0, globals_1.expect)(result).toEqual(mockMatches);
        });
        (0, globals_1.it)('propagates API errors', async () => {
            axios_1.default._instance.get.mockRejectedValueOnce(new Error('Network Error'));
            await (0, globals_1.expect)(matches_1.MatchesService.findMatches({ destinationSedeId: 'SEDE-1' })).rejects.toThrow('Network Error');
        });
    });
    (0, globals_1.describe)('getMyMatches', () => {
        (0, globals_1.it)('should fetch user matches', async () => {
            const mockMatches = [];
            axios_1.default._instance.get.mockResolvedValue({ data: mockMatches });
            const result = await matches_1.MatchesService.getMyMatches();
            (0, globals_1.expect)(axios_1.default._instance.get).toHaveBeenCalledWith('/matches/my-matches');
            (0, globals_1.expect)(result).toEqual(mockMatches);
        });
    });
    (0, globals_1.describe)('getMatchById', () => {
        (0, globals_1.it)('should fetch match by id', async () => {
            const mockMatch = {
                id: '1',
                tripId: 'trip1',
                driverId: 'driver1',
                origin: '40.4168,-3.7038',
                destinationSedeId: 'SEDE-1',
                dateTime: '2024-01-01T08:00:00Z',
                seatsFree: 2,
                score: 0.85,
                reasons: ['Ubicación cercana'],
            };
            axios_1.default._instance.get.mockResolvedValue({ data: mockMatch });
            const result = await matches_1.MatchesService.getMatchById('1');
            (0, globals_1.expect)(axios_1.default._instance.get).toHaveBeenCalledWith('/matches/1');
            (0, globals_1.expect)(result).toEqual(mockMatch);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2FkbWluL0RvY3VtZW50cy9BSTREZXZzLWZpbmFscHJvamVjdC9Gcm9udGVuZC9zcmMvYXBpL21hdGNoZXMudGVzdC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLDJDQUF1RTtBQUt2RSw0Q0FBNEM7QUFDNUMsY0FBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFO0lBQ3RCLE1BQU0sUUFBUSxHQUFHO1FBQ2YsR0FBRyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZCxZQUFZLEVBQUU7WUFDWixPQUFPLEVBQUU7Z0JBQ1AsR0FBRyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7YUFDZjtTQUNGO0tBQ0YsQ0FBQztJQUNGLE9BQU87UUFDTCxVQUFVLEVBQUUsSUFBSTtRQUNoQixPQUFPLEVBQUU7WUFDUCxNQUFNLEVBQUUsR0FBRyxFQUFFLENBQUMsUUFBUTtZQUN0QixTQUFTLEVBQUUsUUFBUTtTQUNwQjtRQUNELE1BQU0sRUFBRSxHQUFHLEVBQUUsQ0FBQyxRQUFRO1FBQ3RCLFNBQVMsRUFBRSxRQUFRO0tBQ3BCLENBQUM7QUFDSixDQUFDLENBQUMsQ0FBQztBQXZCSCx1Q0FBMkM7QUFFM0Msa0RBQTBCO0FBdUIxQixJQUFBLGtCQUFRLEVBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO0lBQzlCLElBQUEsb0JBQVUsRUFBQyxHQUFHLEVBQUU7UUFDZCxjQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLGtCQUFRLEVBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtRQUMzQixJQUFBLFlBQUUsRUFBQyx5Q0FBeUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN2RCxNQUFNLFdBQVcsR0FBZTtnQkFDOUI7b0JBQ0UsRUFBRSxFQUFFLEdBQUc7b0JBQ1AsTUFBTSxFQUFFLE9BQU87b0JBQ2YsUUFBUSxFQUFFLFNBQVM7b0JBQ25CLE1BQU0sRUFBRSxpQkFBaUI7b0JBQ3pCLGlCQUFpQixFQUFFLFFBQVE7b0JBQzNC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QUFTLENBQUMsR0FBRyxDQUFDLENBQUMsb0JBQW9CLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDeEUsSUFBQSxnQkFBTSxFQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNwQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2FkbWluL0RvY3VtZW50cy9BSTREZXZzLWZpbmFscHJvamVjdC9Gcm9udGVuZC9zcmMvYXBpL21hdGNoZXMudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCwgamVzdCwgYmVmb3JlRWFjaCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHsgTWF0Y2hlc1NlcnZpY2UgfSBmcm9tICcuL21hdGNoZXMnO1xuaW1wb3J0IHR5cGUgeyBNYXRjaER0byB9IGZyb20gJy4uL3R5cGVzL2FwaSc7XG5pbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuXG4vLyBNb2NrIGF4aW9zLmNyZWF0ZSB1c2VkIGluc2lkZSB0aGUgc2VydmljZVxuamVzdC5tb2NrKCdheGlvcycsICgpID0+IHtcbiAgY29uc3QgaW5zdGFuY2UgPSB7XG4gICAgZ2V0OiBqZXN0LmZuKCksXG4gICAgaW50ZXJjZXB0b3JzOiB7XG4gICAgICByZXF1ZXN0OiB7XG4gICAgICAgIHVzZTogamVzdC5mbigpLFxuICAgICAgfSxcbiAgICB9LFxuICB9O1xuICByZXR1cm4ge1xuICAgIF9fZXNNb2R1bGU6IHRydWUsXG4gICAgZGVmYXVsdDoge1xuICAgICAgY3JlYXRlOiAoKSA9PiBpbnN0YW5jZSxcbiAgICAgIF9pbnN0YW5jZTogaW5zdGFuY2UsXG4gICAgfSxcbiAgICBjcmVhdGU6ICgpID0+IGluc3RhbmNlLFxuICAgIF9pbnN0YW5jZTogaW5zdGFuY2UsXG4gIH07XG59KTtcblxuZGVzY3JpYmUoJ01hdGNoZXNTZXJ2aWNlJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZpbmRNYXRjaGVzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZmluZCBtYXRjaGVzIHdpdGggYWxsIHBhcmFtZXRlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrTWF0Y2hlczogTWF0Y2hEdG9bXSA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnMScsXG4gICAgICAgICAgdHJpcElkOiAndHJpcDEnLFxuICAgICAgICAgIGRyaXZlcklkOiAnZHJpdmVyMScsXG4gICAgICAgICAgb3JpZ2luOiAnNDAuNDE2OCwtMy43MDM4JyxcbiAgICAgICAgICBkZXN0aW5hdGlvblNlZGVJZDogJ1NFREUtMScsXG4gICAgICAgICAgZGF0ZVRpbWU6ICcyMDI0LTAxLTAxVDA4OjAwOjAwWicsXG4gICAgICAgICAgc2VhdHNGcmVlOiAyLFxuICAgICAgICAgIHNjb3JlOiAwLjg1LFxuICAgICAgICAgIHJlYXNvbnM6IFsnVWJpY2FjacOzbiBjZXJjYW5hJywgJ0hvcmFyaW8gY29tcGF0aWJsZSddLFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgKGF4aW9zIGFzIGFueSkuX2luc3RhbmNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IG1vY2tNYXRjaGVzIH0pO1xuXG4gICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgIGRlc3RpbmF0aW9uU2VkZUlkOiAnU0VERS0xJyxcbiAgICAgICAgdGltZTogJzA4OjMwJyxcbiAgICAgICAgb3JpZ2luOiAnNDAuNDE2OCwtMy43MDM4JyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IE1hdGNoZXNTZXJ2aWNlLmZpbmRNYXRjaGVzKHBhcmFtcyk7XG5cbiAgICAgIGV4cGVjdCgoYXhpb3MgYXMgYW55KS5faW5zdGFuY2UuZ2V0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJy9tYXRjaGVzP2Rlc3RpbmF0aW9uU2VkZUlkPVNFREUtMSZ0aW1lPTA4JTNBMzAmb3JpZ2luPTQwLjQxNjglMkMtMy43MDM4J1xuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja01hdGNoZXMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaW5kIG1hdGNoZXMgd2l0aCBvbmx5IGRlc3RpbmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja01hdGNoZXM6IE1hdGNoRHRvW10gPSBbXTtcblxuICAgICAgKGF4aW9zIGFzIGFueSkuX2luc3RhbmNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IG1vY2tNYXRjaGVzIH0pO1xuXG4gICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgIGRlc3RpbmF0aW9uU2VkZUlkOiAnU0VERS0xJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IE1hdGNoZXNTZXJ2aWNlLmZpbmRNYXRjaGVzKHBhcmFtcyk7XG5cbiAgICAgIGV4cGVjdCgoYXhpb3MgYXMgYW55KS5faW5zdGFuY2UuZ2V0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL21hdGNoZXM/ZGVzdGluYXRpb25TZWRlSWQ9U0VERS0xJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tNYXRjaGVzKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmluZCBtYXRjaGVzIHdpdGggZGVzdGluYXRpb24gYW5kIHRpbWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrTWF0Y2hlczogTWF0Y2hEdG9bXSA9IFtdO1xuXG4gICAgICAoYXhpb3MgYXMgYW55KS5faW5zdGFuY2UuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogbW9ja01hdGNoZXMgfSk7XG5cbiAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgZGVzdGluYXRpb25TZWRlSWQ6ICdTRURFLTEnLFxuICAgICAgICB0aW1lOiAnMDk6MDAnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgTWF0Y2hlc1NlcnZpY2UuZmluZE1hdGNoZXMocGFyYW1zKTtcblxuICAgICAgZXhwZWN0KChheGlvcyBhcyBhbnkpLl9pbnN0YW5jZS5nZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcvbWF0Y2hlcz9kZXN0aW5hdGlvblNlZGVJZD1TRURFLTEmdGltZT0wOSUzQTAwJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tNYXRjaGVzKTtcbiAgICB9KTtcblxuICAgIGl0KCdwcm9wYWdhdGVzIEFQSSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAoYXhpb3MgYXMgYW55KS5faW5zdGFuY2UuZ2V0Lm1vY2tSZWplY3RlZFZhbHVlT25jZShuZXcgRXJyb3IoJ05ldHdvcmsgRXJyb3InKSk7XG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIE1hdGNoZXNTZXJ2aWNlLmZpbmRNYXRjaGVzKHsgZGVzdGluYXRpb25TZWRlSWQ6ICdTRURFLTEnIH0pXG4gICAgICApLnJlamVjdHMudG9UaHJvdygnTmV0d29yayBFcnJvcicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0TXlNYXRjaGVzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZmV0Y2ggdXNlciBtYXRjaGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja01hdGNoZXM6IE1hdGNoRHRvW10gPSBbXTtcblxuICAgICAgKGF4aW9zIGFzIGFueSkuX2luc3RhbmNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IG1vY2tNYXRjaGVzIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBNYXRjaGVzU2VydmljZS5nZXRNeU1hdGNoZXMoKTtcblxuICAgICAgZXhwZWN0KChheGlvcyBhcyBhbnkpLl9pbnN0YW5jZS5nZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcvbWF0Y2hlcy9teS1tYXRjaGVzJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tNYXRjaGVzKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldE1hdGNoQnlJZCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGZldGNoIG1hdGNoIGJ5IGlkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja01hdGNoOiBNYXRjaER0byA9IHtcbiAgICAgICAgaWQ6ICcxJyxcbiAgICAgICAgdHJpcElkOiAndHJpcDEnLFxuICAgICAgICBkcml2ZXJJZDogJ2RyaXZlcjEnLFxuICAgICAgICBvcmlnaW46ICc0MC40MTY4LC0zLjcwMzgnLFxuICAgICAgICBkZXN0aW5hdGlvblNlZGVJZDogJ1NFREUtMScsXG4gICAgICAgIGRhdGVUaW1lOiAnMjAyNC0wMS0wMVQwODowMDowMFonLFxuICAgICAgICBzZWF0c0ZyZWU6IDIsXG4gICAgICAgIHNjb3JlOiAwLjg1LFxuICAgICAgICByZWFzb25zOiBbJ1ViaWNhY2nDs24gY2VyY2FuYSddLFxuICAgICAgfTtcblxuICAgICAgKGF4aW9zIGFzIGFueSkuX2luc3RhbmNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IG1vY2tNYXRjaCB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgTWF0Y2hlc1NlcnZpY2UuZ2V0TWF0Y2hCeUlkKCcxJyk7XG5cbiAgICAgIGV4cGVjdCgoYXhpb3MgYXMgYW55KS5faW5zdGFuY2UuZ2V0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL21hdGNoZXMvMScpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrTWF0Y2gpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9