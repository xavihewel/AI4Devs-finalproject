c5e0275908d9a658769487a2433acc61
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
// Mock axios.create used inside the service, expose a shared instance
globals_1.jest.mock('axios', () => {
    const instance = {
        get: globals_1.jest.fn(),
        post: globals_1.jest.fn(),
        put: globals_1.jest.fn(),
        delete: globals_1.jest.fn(),
        interceptors: {
            request: {
                use: globals_1.jest.fn(),
            },
        },
    };
    return {
        __esModule: true,
        default: {
            create: () => instance,
            _instance: instance,
        },
        create: () => instance,
        _instance: instance,
    };
});
const trips_1 = require("./trips");
const axios_1 = __importDefault(require("axios"));
(0, globals_1.describe)('TripsService', () => {
    (0, globals_1.beforeEach)(() => {
        globals_1.jest.clearAllMocks();
    });
    (0, globals_1.describe)('getAllTrips', () => {
        (0, globals_1.it)('should fetch all trips', async () => {
            const mockTrips = [
                {
                    id: '1',
                    driverId: 'driver1',
                    origin: { lat: 40.4168, lng: -3.7038 },
                    destinationSedeId: 'SEDE-1',
                    dateTime: '2024-01-01T08:00:00Z',
                    seatsTotal: 4,
                    seatsFree: 2,
                    createdAt: '2024-01-01T00:00:00Z',
                    updatedAt: '2024-01-01T00:00:00Z',
                },
            ];
            axios_1.default._instance.get.mockResolvedValue({ data: mockTrips });
            const result = await trips_1.TripsService.getAllTrips();
            (0, globals_1.expect)(axios_1.default._instance.get).toHaveBeenCalledWith('/trips');
            (0, globals_1.expect)(result).toEqual(mockTrips);
        });
        (0, globals_1.it)('propagates API errors', async () => {
            axios_1.default._instance.get.mockRejectedValueOnce(new Error('Boom'));
            await (0, globals_1.expect)(trips_1.TripsService.getAllTrips()).rejects.toThrow('Boom');
        });
    });
    (0, globals_1.describe)('getTripsByDestination', () => {
        (0, globals_1.it)('should fetch trips by destination', async () => {
            const mockTrips = [];
            const destinationSedeId = 'SEDE-1';
            axios_1.default._instance.get.mockResolvedValue({ data: mockTrips });
            const result = await trips_1.TripsService.getTripsByDestination(destinationSedeId);
            (0, globals_1.expect)(axios_1.default._instance.get).toHaveBeenCalledWith(`/trips?destinationSedeId=${destinationSedeId}`);
            (0, globals_1.expect)(result).toEqual(mockTrips);
        });
    });
    (0, globals_1.describe)('getTripById', () => {
        (0, globals_1.it)('should fetch trip by id', async () => {
            const mockTrip = {
                id: '1',
                driverId: 'driver1',
                origin: { lat: 40.4168, lng: -3.7038 },
                destinationSedeId: 'SEDE-1',
                dateTime: '2024-01-01T08:00:00Z',
                seatsTotal: 4,
                seatsFree: 2,
                createdAt: '2024-01-01T00:00:00Z',
                updatedAt: '2024-01-01T00:00:00Z',
            };
            axios_1.default._instance.get.mockResolvedValue({ data: mockTrip });
            const result = await trips_1.TripsService.getTripById('1');
            (0, globals_1.expect)(axios_1.default._instance.get).toHaveBeenCalledWith('/trips/1');
            (0, globals_1.expect)(result).toEqual(mockTrip);
        });
    });
    (0, globals_1.describe)('createTrip', () => {
        (0, globals_1.it)('should create a new trip', async () => {
            const tripData = {
                origin: { lat: 40.4168, lng: -3.7038 },
                destinationSedeId: 'SEDE-1',
                dateTime: '2024-01-01T08:00:00Z',
                seatsTotal: 4,
            };
            const mockCreatedTrip = {
                id: '1',
                driverId: 'driver1',
                ...tripData,
                seatsFree: 4,
                createdAt: '2024-01-01T00:00:00Z',
                updatedAt: '2024-01-01T00:00:00Z',
            };
            axios_1.default._instance.post.mockResolvedValue({ data: mockCreatedTrip });
            const result = await trips_1.TripsService.createTrip(tripData);
            (0, globals_1.expect)(axios_1.default._instance.post).toHaveBeenCalledWith('/trips', tripData);
            (0, globals_1.expect)(result).toEqual(mockCreatedTrip);
        });
    });
    (0, globals_1.describe)('updateTrip', () => {
        (0, globals_1.it)('should update an existing trip', async () => {
            const updateData = { seatsTotal: 5 };
            const mockUpdatedTrip = {
                id: '1',
                driverId: 'driver1',
                origin: { lat: 40.4168, lng: -3.7038 },
                destinationSedeId: 'SEDE-1',
                dateTime: '2024-01-01T08:00:00Z',
                seatsTotal: 5,
                seatsFree: 2,
                createdAt: '2024-01-01T00:00:00Z',
                updatedAt: '2024-01-01T00:00:00Z',
            };
            axios_1.default._instance.put.mockResolvedValue({ data: mockUpdatedTrip });
            const result = await trips_1.TripsService.updateTrip('1', updateData);
            (0, globals_1.expect)(axios_1.default._instance.put).toHaveBeenCalledWith('/trips/1', updateData);
            (0, globals_1.expect)(result).toEqual(mockUpdatedTrip);
        });
    });
    (0, globals_1.describe)('deleteTrip', () => {
        (0, globals_1.it)('should delete a trip', async () => {
            axios_1.default._instance.delete.mockResolvedValue({});
            await trips_1.TripsService.deleteTrip('1');
            (0, globals_1.expect)(axios_1.default._instance.delete).toHaveBeenCalledWith('/trips/1');
        });
    });
    (0, globals_1.describe)('getMyTrips', () => {
        (0, globals_1.it)('should fetch user trips', async () => {
            const mockTrips = [];
            axios_1.default._instance.get.mockResolvedValue({ data: mockTrips });
            const result = await trips_1.TripsService.getMyTrips();
            (0, globals_1.expect)(axios_1.default._instance.get).toHaveBeenCalledWith('/trips/my-trips');
            (0, globals_1.expect)(result).toEqual(mockTrips);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2FkbWluL0RvY3VtZW50cy9BSTREZXZzLWZpbmFscHJvamVjdC9Gcm9udGVuZC9zcmMvYXBpL3RyaXBzLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSwyQ0FBdUU7QUFLdkUsc0VBQXNFO0FBQ3RFLGNBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRTtJQUN0QixNQUFNLFFBQVEsR0FBRztRQUNmLEdBQUcsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2QsSUFBSSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZixHQUFHLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNkLE1BQU0sRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pCLFlBQVksRUFBRTtZQUNaLE9BQU8sRUFBRTtnQkFDUCxHQUFHLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTthQUNmO1NBQ0Y7S0FDRixDQUFDO0lBQ0YsT0FBTztRQUNMLFVBQVUsRUFBRSxJQUFJO1FBQ2hCLE9BQU8sRUFBRTtZQUNQLE1BQU0sRUFBRSxHQUFHLEVBQUUsQ0FBQyxRQUFRO1lBQ3RCLFNBQVMsRUFBRSxRQUFRO1NBQ3BCO1FBQ0QsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLFFBQVE7UUFDdEIsU0FBUyxFQUFFLFFBQVE7S0FDcEIsQ0FBQztBQUNKLENBQUMsQ0FBQyxDQUFDO0FBMUJILG1DQUF1QztBQUV2QyxrREFBMEI7QUEwQjFCLElBQUEsa0JBQVEsRUFBQyxjQUFjLEVBQUUsR0FBRyxFQUFFO0lBQzVCLElBQUEsb0JBQVUsRUFBQyxHQUFHLEVBQUU7UUFDZCxjQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLGtCQUFRLEVBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtRQUMzQixJQUFBLFlBQUUsRUFBQyx3QkFBd0IsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN0QyxNQUFNLFNBQVMsR0FBYztnQkFDM0I7b0JBQ0UsRUFBRSxFQUFF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WUFBRSxFQUFDLHNCQUFzQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ25DLGVBQWEsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRXRELE1BQU0sb0JBQVksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFbkMsSUFBQSxnQkFBTSxFQUFFLGVBQWEsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDM0UsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsa0JBQVEsRUFBQyxZQUFZLEVBQUUsR0FBRyxFQUFFO1FBQzFCLElBQUEsWUFBRSxFQUFDLHlCQUF5QixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3ZDLE1BQU0sU0FBUyxHQUFjLEVBQUUsQ0FBQztZQUUvQixlQUFhLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDO1lBRXBFLE1BQU0sTUFBTSxHQUFHLE1BQU0sb0JBQVksQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUUvQyxJQUFBLGdCQUFNLEVBQUUsZUFBYSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1lBQzdFLElBQUEsZ0JBQU0sRUFBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDcEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9hZG1pbi9Eb2N1bWVudHMvQUk0RGV2cy1maW5hbHByb2plY3QvRnJvbnRlbmQvc3JjL2FwaS90cmlwcy50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0LCBqZXN0LCBiZWZvcmVFYWNoIH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5pbXBvcnQgeyBUcmlwc1NlcnZpY2UgfSBmcm9tICcuL3RyaXBzJztcbmltcG9ydCB0eXBlIHsgVHJpcER0bywgVHJpcENyZWF0ZUR0byB9IGZyb20gJy4uL3R5cGVzL2FwaSc7XG5pbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuXG4vLyBNb2NrIGF4aW9zLmNyZWF0ZSB1c2VkIGluc2lkZSB0aGUgc2VydmljZSwgZXhwb3NlIGEgc2hhcmVkIGluc3RhbmNlXG5qZXN0Lm1vY2soJ2F4aW9zJywgKCkgPT4ge1xuICBjb25zdCBpbnN0YW5jZSA9IHtcbiAgICBnZXQ6IGplc3QuZm4oKSxcbiAgICBwb3N0OiBqZXN0LmZuKCksXG4gICAgcHV0OiBqZXN0LmZuKCksXG4gICAgZGVsZXRlOiBqZXN0LmZuKCksXG4gICAgaW50ZXJjZXB0b3JzOiB7XG4gICAgICByZXF1ZXN0OiB7XG4gICAgICAgIHVzZTogamVzdC5mbigpLFxuICAgICAgfSxcbiAgICB9LFxuICB9O1xuICByZXR1cm4ge1xuICAgIF9fZXNNb2R1bGU6IHRydWUsXG4gICAgZGVmYXVsdDoge1xuICAgICAgY3JlYXRlOiAoKSA9PiBpbnN0YW5jZSxcbiAgICAgIF9pbnN0YW5jZTogaW5zdGFuY2UsXG4gICAgfSxcbiAgICBjcmVhdGU6ICgpID0+IGluc3RhbmNlLFxuICAgIF9pbnN0YW5jZTogaW5zdGFuY2UsXG4gIH07XG59KTtcblxuZGVzY3JpYmUoJ1RyaXBzU2VydmljZScsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRBbGxUcmlwcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGZldGNoIGFsbCB0cmlwcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tUcmlwczogVHJpcER0b1tdID0gW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICcxJyxcbiAgICAgICAgICBkcml2ZXJJZDogJ2RyaXZlcjEnLFxuICAgICAgICAgIG9yaWdpbjogeyBsYXQ6IDQwLjQxNjgsIGxuZzogLTMuNzAzOCB9LFxuICAgICAgICAgIGRlc3RpbmF0aW9uU2VkZUlkOiAnU0VERS0xJyxcbiAgICAgICAgICBkYXRlVGltZTogJzIwMjQtMDEtMDFUMDg6MDA6MDBaJyxcbiAgICAgICAgICBzZWF0c1RvdGFsOiA0LFxuICAgICAgICAgIHNlYXRzRnJlZTogMixcbiAgICAgICAgICBjcmVhdGVkQXQ6ICcyMDI0LTAxLTAxVDAwOjAwOjAwWicsXG4gICAgICAgICAgdXBkYXRlZEF0OiAnMjAyNC0wMS0wMVQwMDowMDowMFonLFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgKGF4aW9zIGFzIGFueSkuX2luc3RhbmNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IG1vY2tUcmlwcyB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgVHJpcHNTZXJ2aWNlLmdldEFsbFRyaXBzKCk7XG5cbiAgICAgIGV4cGVjdCgoYXhpb3MgYXMgYW55KS5faW5zdGFuY2UuZ2V0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL3RyaXBzJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tUcmlwcyk7XG4gICAgfSk7XG5cbiAgICBpdCgncHJvcGFnYXRlcyBBUEkgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKGF4aW9zIGFzIGFueSkuX2luc3RhbmNlLmdldC5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UobmV3IEVycm9yKCdCb29tJykpO1xuICAgICAgYXdhaXQgZXhwZWN0KFRyaXBzU2VydmljZS5nZXRBbGxUcmlwcygpKS5yZWplY3RzLnRvVGhyb3coJ0Jvb20nKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFRyaXBzQnlEZXN0aW5hdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGZldGNoIHRyaXBzIGJ5IGRlc3RpbmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1RyaXBzOiBUcmlwRHRvW10gPSBbXTtcbiAgICAgIGNvbnN0IGRlc3RpbmF0aW9uU2VkZUlkID0gJ1NFREUtMSc7XG5cbiAgICAgIChheGlvcyBhcyBhbnkpLl9pbnN0YW5jZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBtb2NrVHJpcHMgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFRyaXBzU2VydmljZS5nZXRUcmlwc0J5RGVzdGluYXRpb24oZGVzdGluYXRpb25TZWRlSWQpO1xuXG4gICAgICBleHBlY3QoKGF4aW9zIGFzIGFueSkuX2luc3RhbmNlLmdldCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoYC90cmlwcz9kZXN0aW5hdGlvblNlZGVJZD0ke2Rlc3RpbmF0aW9uU2VkZUlkfWApO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrVHJpcHMpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0VHJpcEJ5SWQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBmZXRjaCB0cmlwIGJ5IGlkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1RyaXA6IFRyaXBEdG8gPSB7XG4gICAgICAgIGlkOiAnMScsXG4gICAgICAgIGRyaXZlcklkOiAnZHJpdmVyMScsXG4gICAgICAgIG9yaWdpbjogeyBsYXQ6IDQwLjQxNjgsIGxuZzogLTMuNzAzOCB9LFxuICAgICAgICBkZXN0aW5hdGlvblNlZGVJZDogJ1NFREUtMScsXG4gICAgICAgIGRhdGVUaW1lOiAnMjAyNC0wMS0wMVQwODowMDowMFonLFxuICAgICAgICBzZWF0c1RvdGFsOiA0LFxuICAgICAgICBzZWF0c0ZyZWU6IDIsXG4gICAgICAgIGNyZWF0ZWRBdDogJzIwMjQtMDEtMDFUMDA6MDA6MDBaJyxcbiAgICAgICAgdXBkYXRlZEF0OiAnMjAyNC0wMS0wMVQwMDowMDowMFonLFxuICAgICAgfTtcblxuICAgICAgKGF4aW9zIGFzIGFueSkuX2luc3RhbmNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IG1vY2tUcmlwIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBUcmlwc1NlcnZpY2UuZ2V0VHJpcEJ5SWQoJzEnKTtcblxuICAgICAgZXhwZWN0KChheGlvcyBhcyBhbnkpLl9pbnN0YW5jZS5nZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcvdHJpcHMvMScpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrVHJpcCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGVUcmlwJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgbmV3IHRyaXAnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0cmlwRGF0YTogVHJpcENyZWF0ZUR0byA9IHtcbiAgICAgICAgb3JpZ2luOiB7IGxhdDogNDAuNDE2OCwgbG5nOiAtMy43MDM4IH0sXG4gICAgICAgIGRlc3RpbmF0aW9uU2VkZUlkOiAnU0VERS0xJyxcbiAgICAgICAgZGF0ZVRpbWU6ICcyMDI0LTAxLTAxVDA4OjAwOjAwWicsXG4gICAgICAgIHNlYXRzVG90YWw6IDQsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrQ3JlYXRlZFRyaXA6IFRyaXBEdG8gPSB7XG4gICAgICAgIGlkOiAnMScsXG4gICAgICAgIGRyaXZlcklkOiAnZHJpdmVyMScsXG4gICAgICAgIC4uLnRyaXBEYXRhLFxuICAgICAgICBzZWF0c0ZyZWU6IDQsXG4gICAgICAgIGNyZWF0ZWRBdDogJzIwMjQtMDEtMDFUMDA6MDA6MDBaJyxcbiAgICAgICAgdXBkYXRlZEF0OiAnMjAyNC0wMS0wMVQwMDowMDowMFonLFxuICAgICAgfTtcblxuICAgICAgKGF4aW9zIGFzIGFueSkuX2luc3RhbmNlLnBvc3QubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBtb2NrQ3JlYXRlZFRyaXAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFRyaXBzU2VydmljZS5jcmVhdGVUcmlwKHRyaXBEYXRhKTtcblxuICAgICAgZXhwZWN0KChheGlvcyBhcyBhbnkpLl9pbnN0YW5jZS5wb3N0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL3RyaXBzJywgdHJpcERhdGEpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrQ3JlYXRlZFRyaXApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXBkYXRlVHJpcCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBhbiBleGlzdGluZyB0cmlwJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHsgc2VhdHNUb3RhbDogNSB9O1xuICAgICAgY29uc3QgbW9ja1VwZGF0ZWRUcmlwOiBUcmlwRHRvID0ge1xuICAgICAgICBpZDogJzEnLFxuICAgICAgICBkcml2ZXJJZDogJ2RyaXZlcjEnLFxuICAgICAgICBvcmlnaW46IHsgbGF0OiA0MC40MTY4LCBsbmc6IC0zLjcwMzggfSxcbiAgICAgICAgZGVzdGluYXRpb25TZWRlSWQ6ICdTRURFLTEnLFxuICAgICAgICBkYXRlVGltZTogJzIwMjQtMDEtMDFUMDg6MDA6MDBaJyxcbiAgICAgICAgc2VhdHNUb3RhbDogNSxcbiAgICAgICAgc2VhdHNGcmVlOiAyLFxuICAgICAgICBjcmVhdGVkQXQ6ICcyMDI0LTAxLTAxVDAwOjAwOjAwWicsXG4gICAgICAgIHVwZGF0ZWRBdDogJzIwMjQtMDEtMDFUMDA6MDA6MDBaJyxcbiAgICAgIH07XG5cbiAgICAgIChheGlvcyBhcyBhbnkpLl9pbnN0YW5jZS5wdXQubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBtb2NrVXBkYXRlZFRyaXAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFRyaXBzU2VydmljZS51cGRhdGVUcmlwKCcxJywgdXBkYXRlRGF0YSk7XG5cbiAgICAgIGV4cGVjdCgoYXhpb3MgYXMgYW55KS5faW5zdGFuY2UucHV0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL3RyaXBzLzEnLCB1cGRhdGVEYXRhKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1VwZGF0ZWRUcmlwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2RlbGV0ZVRyaXAnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBkZWxldGUgYSB0cmlwJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKGF4aW9zIGFzIGFueSkuX2luc3RhbmNlLmRlbGV0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XG5cbiAgICAgIGF3YWl0IFRyaXBzU2VydmljZS5kZWxldGVUcmlwKCcxJyk7XG5cbiAgICAgIGV4cGVjdCgoYXhpb3MgYXMgYW55KS5faW5zdGFuY2UuZGVsZXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL3RyaXBzLzEnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldE15VHJpcHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBmZXRjaCB1c2VyIHRyaXBzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1RyaXBzOiBUcmlwRHRvW10gPSBbXTtcblxuICAgICAgKGF4aW9zIGFzIGFueSkuX2luc3RhbmNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IG1vY2tUcmlwcyB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgVHJpcHNTZXJ2aWNlLmdldE15VHJpcHMoKTtcblxuICAgICAgZXhwZWN0KChheGlvcyBhcyBhbnkpLl9pbnN0YW5jZS5nZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcvdHJpcHMvbXktdHJpcHMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1RyaXBzKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==